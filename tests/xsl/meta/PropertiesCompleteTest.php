<?php

declare(strict_types=1);
require_once __DIR__.'/../../../vendor/autoload.php';

use PHPUnit\Framework\TestCase;

final class PropertiesCompleteTest extends TestCase
{
    /**
     * @see https://www.w3.org/TR/xsl11/#d0e44425
     */
    private static array $specificationList = [
        '7.6.1 absolute-position',
        '7.23.1 active-state',
        '7.14.1 alignment-adjust',
        '7.14.2 alignment-baseline',
        '7.15.1 allowed-height-scale',
        '7.15.2 allowed-width-scale',
        '7.23.2 auto-restore',
        '7.7.1 azimuth',
        '7.31.1 background',
        '7.8.1 background-attachment',
        '7.8.2 background-color',
        '7.8.3 background-image',
        '7.31.2 background-position',
        '7.8.5 background-position-horizontal',
        '7.8.6 background-position-vertical',
        '7.8.4 background-repeat',
        '7.14.3 baseline-shift',
        '7.27.1 blank-or-not-blank',
        '7.15.3 block-progression-dimension',
        '7.31.3 border',
        '7.8.10 border-after-color',
        '7.28.1 border-after-precedence',
        '7.8.11 border-after-style',
        '7.8.12 border-after-width',
        '7.8.7 border-before-color',
        '7.28.2 border-before-precedence',
        '7.8.8 border-before-style',
        '7.8.9 border-before-width',
        '7.31.4 border-bottom',
        '7.8.22 border-bottom-color',
        '7.8.23 border-bottom-style',
        '7.8.24 border-bottom-width',
        '7.28.3 border-collapse',
        '7.31.5 border-color',
        '7.8.16 border-end-color',
        '7.28.4 border-end-precedence',
        '7.8.17 border-end-style',
        '7.8.18 border-end-width',
        '7.31.6 border-left',
        '7.8.25 border-left-color',
        '7.8.26 border-left-style',
        '7.8.27 border-left-width',
        '7.31.7 border-right',
        '7.8.28 border-right-color',
        '7.8.29 border-right-style',
        '7.8.30 border-right-width',
        '7.28.5 border-separation',
        '7.31.9 border-spacing',
        '7.8.13 border-start-color',
        '7.28.6 border-start-precedence',
        '7.8.14 border-start-style',
        '7.8.15 border-start-width',
        '7.31.8 border-style',
        '7.31.10 border-top',
        '7.8.19 border-top-color',
        '7.8.20 border-top-style',
        '7.8.21 border-top-width',
        '7.31.11 border-width',
        '7.6.4 bottom',
        '7.20.1 break-after',
        '7.20.2 break-before',
        '7.28.7 caption-side',
        '7.23.3 case-name',
        '7.23.4 case-title',
        '7.30.1 change-bar-class',
        '7.30.2 change-bar-color',
        '7.30.3 change-bar-offset',
        '7.30.4 change-bar-placement',
        '7.30.5 change-bar-style',
        '7.30.6 change-bar-width',
        '7.17.1 character',
        '7.19.1 clear',
        '7.21.1 clip',
        '7.18.1 color',
        '7.18.2 color-profile-name',
        '7.27.2 column-count',
        '7.27.3 column-gap',
        '7.28.8 column-number',
        '7.28.9 column-width',
        '7.15.4 content-height',
        '7.30.7 content-type',
        '7.15.5 content-width',
        '7.10.1 country',
        '7.31.12 cue',
        '7.7.2 cue-after',
        '7.7.3 cue-before',
        '7.23.5 destination-placement-offset',
        '7.29.1 direction',
        '7.14.4 display-align',
        '7.14.5 dominant-baseline',
        '7.7.4 elevation',
        '7.28.10 empty-cells',
        '7.11.8 end-indent',
        '7.28.11 ends-row',
        '7.27.4 extent',
        '7.23.6 external-destination',
        '7.19.2 float',
        '7.27.18 flow-map-name',
        '7.27.19 flow-map-reference',
        '7.27.5 flow-name',
        '7.27.20 flow-name-reference',
        '7.31.13 font',
        '7.9.2 font-family',
        '7.9.3 font-selection-strategy',
        '7.9.4 font-size',
        '7.9.6 font-size-adjust',
        '7.9.5 font-stretch',
        '7.9.7 font-style',
        '7.9.8 font-variant',
        '7.9.9 font-weight',
        '7.27.6 force-page-count',
        '7.26.1 format',
        '7.29.2 glyph-orientation-horizontal',
        '7.29.3 glyph-orientation-vertical',
        '7.26.2 grouping-separator',
        '7.26.3 grouping-size',
        '7.15.6 height',
        '7.10.4 hyphenate',
        '7.10.5 hyphenation-character',
        '7.16.1 hyphenation-keep',
        '7.16.2 hyphenation-ladder-count',
        '7.10.6 hyphenation-push-character-count',
        '7.10.7 hyphenation-remain-character-count',
        '7.30.8 id',
        '7.24.1 index-class',
        '7.24.2 index-key',
        '7.23.7 indicate-destination',
        '7.27.7 initial-page-number',
        '7.15.7 inline-progression-dimension',
        '7.23.8 internal-destination',
        '7.30.9 intrinsic-scale-value',
        '7.19.3 intrusion-displace',
        '7.20.3 keep-together',
        '7.20.4 keep-with-next',
        '7.20.5 keep-with-previous',
        '7.10.2 language',
        '7.16.3 last-line-end-indent',
        '7.22.1 leader-alignment',
        '7.22.4 leader-length',
        '7.22.2 leader-pattern',
        '7.22.3 leader-pattern-width',
        '7.6.5 left',
        '7.17.2 letter-spacing',
        '7.26.4 letter-value',
        '7.16.7 linefeed-treatment',
        '7.16.4 line-height',
        '7.16.5 line-height-shift-adjustment',
        '7.16.6 line-stacking-strategy',
        '7.31.14 margin',
        '7.11.2 margin-bottom',
        '7.11.3 margin-left',
        '7.11.4 margin-right',
        '7.11.1 margin-top',
        '7.25.1 marker-class-name',
        '7.27.8 master-name',
        '7.27.9 master-reference',
        '7.15.8 max-height',
        '7.27.10 maximum-repeats',
        '7.15.9 max-width',
        '7.27.11 media-usage',
        '7.24.6 merge-pages-across-index-key-references',
        '7.24.4 merge-ranges-across-index-key-references',
        '7.24.5 merge-sequential-page-numbers',
        '7.15.10 min-height',
        '7.15.11 min-width',
        '7.28.12 number-columns-repeated',
        '7.28.13 number-columns-spanned',
        '7.28.14 number-rows-spanned',
        '7.27.12 odd-or-even',
        '7.20.6 orphans',
        '7.21.2 overflow',
        '7.31.15 padding',
        '7.8.32 padding-after',
        '7.8.31 padding-before',
        '7.8.36 padding-bottom',
        '7.8.34 padding-end',
        '7.8.37 padding-left',
        '7.8.38 padding-right',
        '7.8.33 padding-start',
        '7.8.35 padding-top',
        '7.31.16 page-break-after',
        '7.31.17 page-break-before',
        '7.31.18 page-break-inside',
        '7.30.10 page-citation-strategy',
        '7.27.13 page-height',
        '7.24.3 page-number-treatment',
        '7.27.14 page-position',
        '7.27.15 page-width',
        '7.31.19 pause',
        '7.7.5 pause-after',
        '7.7.6 pause-before',
        '7.7.7 pitch',
        '7.7.8 pitch-range',
        '7.7.9 play-during',
        '7.31.20 position',
        '7.27.16 precedence',
        '7.30.12 provisional-distance-between-starts',
        '7.30.11 provisional-label-separation',
        '7.21.3 reference-orientation',
        '7.30.13 ref-id',
        '7.24.7 ref-index-key',
        '7.27.17 region-name',
        '7.27.21 region-name-reference',
        '7.14.6 relative-align',
        '7.13.5 relative-position',
        '7.18.3 rendering-intent',
        '7.25.5 retrieve-boundary',
        '7.25.2 retrieve-boundary-within-table',
        '7.25.3 retrieve-class-name',
        '7.25.4 retrieve-position',
        '7.25.6 retrieve-position-within-table',
        '7.7.10 richness',
        '7.6.3 right',
        '7.5.2 role',
        '7.22.5 rule-style',
        '7.22.6 rule-thickness',
        '7.30.14 scale-option',
        '7.15.12 scaling',
        '7.15.13 scaling-method',
        '7.30.15 score-spaces',
        '7.10.3 script',
        '7.23.9 show-destination',
        '7.31.21 size',
        '7.5.1 source-document',
        '7.11.6 space-after',
        '7.11.5 space-before',
        '7.12.5 space-end',
        '7.12.6 space-start',
        '7.21.4 span',
        '7.7.11 speak',
        '7.7.12 speak-header',
        '7.7.13 speak-numeral',
        '7.7.14 speak-punctuation',
        '7.7.15 speech-rate',
        '7.30.16 src',
        '7.11.7 start-indent',
        '7.23.10 starting-state',
        '7.28.15 starts-row',
        '7.7.16 stress',
        '7.17.3 suppress-at-line-break',
        '7.23.11 switch-to',
        '7.28.16 table-layout',
        '7.28.17 table-omit-footer-at-break',
        '7.28.18 table-omit-header-at-break',
        '7.23.12 target-presentation-context',
        '7.23.13 target-processing-context',
        '7.23.14 target-stylesheet',
        '7.16.9 text-align',
        '7.16.10 text-align-last',
        '7.29.4 text-altitude',
        '7.17.4 text-decoration',
        '7.29.5 text-depth',
        '7.16.11 text-indent',
        '7.17.5 text-shadow',
        '7.17.6 text-transform',
        '7.6.2 top',
        '7.17.7 treat-as-word-space',
        '7.29.6 unicode-bidi',
        '7.31.22 vertical-align',
        '7.30.17 visibility',
        '7.7.17 voice-family',
        '7.7.18 volume',
        '7.31.23 white-space',
        '7.16.12 white-space-collapse',
        '7.16.8 white-space-treatment',
        '7.20.7 widows',
        '7.15.14 width',
        '7.17.8 word-spacing',
        '7.16.13 wrap-option',
        '7.29.7 writing-mode',
        '7.31.24 xml:lang',
        '7.30.18 z-index',
    ];

    private static RegexIterator $files;

    private array $properties;

    public static function setUpBeforeClass(): void
    {
        $directory = __DIR__.'/../properties/';
        $dir = new RecursiveDirectoryIterator($directory);
        $flat = new RecursiveIteratorIterator($dir);
        self::$files = new RegexIterator($flat, '/\.php$/i');
    }

    private function getProperties(): array
    {
        if (! isset($this->properties)) {
            $this->properties = [];
            foreach (self::$specificationList as $line) {
                $parts = explode(' ', $line);
                $this->properties[] = trim($parts[1]);
            }
        }

        return $this->properties;
    }

    private function isTested(string $file)
    {
        $className = substr($file, 0, strlen($file) - strlen('Test.php'));
        $propertyName = preg_replace('/([A-Z])/', '-\1', $className);
        $propertyName = strtolower(ltrim($file, '-'));

        // Exception
        if ($propertyName = 'xml-lang') {
            $propertyName = 'xml:lang';
        }

        return in_array($propertyName, $this->getProperties());
    }

    public function test_invalid_name()
    {
        foreach (self::$files as $file) {
            $file = strval($file);
            $this->assertTrue($this->isTested($file), $file);
        }
    }
}
